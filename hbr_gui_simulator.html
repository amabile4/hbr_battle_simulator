<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ˜ãƒ–ãƒ³ãƒãƒ¼ãƒ³ã‚ºãƒ¬ãƒƒãƒ‰æˆ¦é—˜ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        /* ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ç·¨æˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .party-setup {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .party-setup.collapsed {
            padding: 15px 25px;
        }
        
        .party-setup.collapsed .character-config {
            display: none;
        }
        
        .party-setup.collapsed .controls {
            display: none;
        }
        
        .party-setup h2 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.5em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: color 0.3s ease;
        }
        
        .party-setup h2:hover {
            color: #667eea;
        }
        
        .party-setup.collapsed h2 {
            margin-bottom: 5px;
        }
        
        .collapse-icon {
            font-size: 1.2em;
            transition: transform 0.3s ease;
        }
        
        .party-setup.collapsed .collapse-icon {
            transform: rotate(-90deg);
        }
        
        .party-status {
            display: none;
            color: #38a169;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .party-setup.collapsed .party-status {
            display: block;
        }
        
        .character-config {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .character-slot {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
        }
        
        .character-slot h3 {
            color: #2d3748;
            margin-bottom: 10px;
        }
        
        .input-group {
            margin-bottom: 10px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #4a5568;
        }
        
        .input-group select,
        .input-group input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #cbd5e0;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .input-group select:focus,
        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        /* ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼è¡¨ç¤º */
        .party-display {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .party-formation {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .character-card {
            position: relative;
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #4299e1, #3182ce);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            text-align: center;
            line-height: 1.2;
        }
        
        .character-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .character-card.front {
            background: linear-gradient(135deg, #48bb78, #38a169);
        }
        
        .character-card.back {
            background: linear-gradient(135deg, #ed8936, #dd6b20);
        }
        
        .character-card.selected {
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        
        .character-card.swap-mode {
            cursor: pointer;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
        }
        
        .sp-display {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .position-labels {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 20px;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .position-label {
            font-weight: bold;
            color: #4a5568;
        }
        
        .position-label.front {
            color: #38a169;
        }
        
        .position-label.back {
            color: #dd6b20;
        }
        
        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« */
        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(72, 187, 120, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ed8936, #dd6b20);
            color: white;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(237, 137, 54, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* ã‚¹ã‚­ãƒ«é¸æŠ */
        .skill-selection {
            margin-top: 20px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
        }
        
        .skill-selection h3 {
            margin-bottom: 15px;
            color: #2d3748;
        }
        
        .skill-dropdown {
            width: 100%;
            padding: 10px;
            border: 1px solid #cbd5e0;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .skill-dropdown option:disabled {
            color: #a0aec0;
            background-color: #f7fafc;
        }
        
        /* çµæœãƒ†ãƒ¼ãƒ–ãƒ« */
        .results-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .results-table th,
        .results-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }
        
        .results-table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: bold;
        }
        
        .results-table tr:nth-child(even) {
            background: #f7fafc;
        }
        
        .results-table tr:hover {
            background: #edf2f7;
        }
        
        /* ã‚¿ãƒ¼ãƒ³æƒ…å ± */
        .turn-info {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
        }
        
        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .character-config {
                grid-template-columns: 1fr;
            }
            
            .party-formation {
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
            }
            
            .character-card {
                width: 100px;
                height: 100px;
                font-size: 11px;
            }
            
            .skill-display {
                width: 100px;
                font-size: 10px;
                min-height: 20px;
                padding: 2px 4px;
            }
            
            .sp-display {
                width: 24px;
                height: 16px;
                font-size: 10px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”¥ ãƒ˜ãƒ–ãƒ³ãƒãƒ¼ãƒ³ã‚ºãƒ¬ãƒƒãƒ‰ æˆ¦é—˜ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿</h1>
            <p>æˆ¦è¡“çš„ãªæˆ¦é—˜ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¦æœ€é©ãªæˆ¦ç•¥ã‚’è¦‹ã¤ã‘ã‚ˆã†</p>
        </div>
        
        <!-- ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ç·¨æˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="party-setup" id="partySetup">
            <h2 onclick="togglePartySetup()">
                ğŸ“ ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ç·¨æˆ
                <span class="collapse-icon">ğŸ”½</span>
            </h2>
            <div class="party-status" id="partyStatus">
                âœ… ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ç·¨æˆå®Œäº† - ã‚¯ãƒªãƒƒã‚¯ã—ã¦å†ç·¨é›†
            </div>
            <div class="character-config" id="characterConfig">
                <div class="character-slot">
                    <h3>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ 1</h3>
                    <div class="input-group">
                        <label>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠ</label>
                        <select id="char_0" onchange="updateCharacterSelection()">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="èŒ…æ£®æœˆæ­Œ">èŒ…æ£®æœˆæ­Œ</option>
                            <option value="å’Œæ³‰ãƒ¦ã‚­">å’Œæ³‰ãƒ¦ã‚­</option>
                            <option value="é€¢å·ã‚ãã¿">é€¢å·ã‚ãã¿</option>
                            <option value="æ±åŸã¤ã‹ã•">æ±åŸã¤ã‹ã•</option>
                            <option value="æœå€‰å¯æ†">æœå€‰å¯æ†</option>
                            <option value="åœ‹è¦‹ã‚¿ãƒ">åœ‹è¦‹ã‚¿ãƒ</option>
                            <option value="è’¼äº•ãˆã‚Šã‹">è’¼äº•ãˆã‚Šã‹</option>
                            <option value="æ°´ç€¬ã„ã¡ã”">æ°´ç€¬ã„ã¡ã”</option>
                            <option value="æ°´ç€¬ã™ã‚‚ã‚‚">æ°´ç€¬ã™ã‚‚ã‚‚</option>
                            <option value="æ¨‹å£è–è¯">æ¨‹å£è–è¯</option>
                            <option value="æŸŠæœ¨æ¢¢">æŸŠæœ¨æ¢¢</option>
                            <option value="ãƒ“ãƒ£ãƒƒã‚³">ãƒ“ãƒ£ãƒƒã‚³</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>åˆæœŸSP (åŸºæœ¬4 + è£…å‚™ + ãƒ‘ãƒƒã‚·ãƒ–)</label>
                        <input type="number" id="sp_0" min="4" max="20" value="6" onchange="updateCharacterSelection()">
                    </div>
                    <div class="input-group">
                        <label>ã‚¿ãƒ¼ãƒ³çµŒéSPè¿½åŠ ãƒœãƒ¼ãƒŠã‚¹ (åŸºæœ¬+2ã«ä¸Šä¹—ã›)</label>
                        <input type="number" id="bonus_0" min="0" max="3" value="0" onchange="updateCharacterSelection()">
                    </div>
                </div>
                
                <div class="character-slot">
                    <h3>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ 2</h3>
                    <div class="input-group">
                        <label>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠ</label>
                        <select id="char_1" onchange="updateCharacterSelection()">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="èŒ…æ£®æœˆæ­Œ">èŒ…æ£®æœˆæ­Œ</option>
                            <option value="å’Œæ³‰ãƒ¦ã‚­">å’Œæ³‰ãƒ¦ã‚­</option>
                            <option value="é€¢å·ã‚ãã¿">é€¢å·ã‚ãã¿</option>
                            <option value="æ±åŸã¤ã‹ã•">æ±åŸã¤ã‹ã•</option>
                            <option value="æœå€‰å¯æ†">æœå€‰å¯æ†</option>
                            <option value="åœ‹è¦‹ã‚¿ãƒ">åœ‹è¦‹ã‚¿ãƒ</option>
                            <option value="è’¼äº•ãˆã‚Šã‹">è’¼äº•ãˆã‚Šã‹</option>
                            <option value="æ°´ç€¬ã„ã¡ã”">æ°´ç€¬ã„ã¡ã”</option>
                            <option value="æ°´ç€¬ã™ã‚‚ã‚‚">æ°´ç€¬ã™ã‚‚ã‚‚</option>
                            <option value="æ¨‹å£è–è¯">æ¨‹å£è–è¯</option>
                            <option value="æŸŠæœ¨æ¢¢">æŸŠæœ¨æ¢¢</option>
                            <option value="ãƒ“ãƒ£ãƒƒã‚³">ãƒ“ãƒ£ãƒƒã‚³</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>åˆæœŸSP (åŸºæœ¬4 + è£…å‚™ + ãƒ‘ãƒƒã‚·ãƒ–)</label>
                        <input type="number" id="sp_1" min="4" max="20" value="6" onchange="updateCharacterSelection()">
                    </div>
                    <div class="input-group">
                        <label>ã‚¿ãƒ¼ãƒ³çµŒéSPè¿½åŠ ãƒœãƒ¼ãƒŠã‚¹ (åŸºæœ¬+2ã«ä¸Šä¹—ã›)</label>
                        <input type="number" id="bonus_1" min="0" max="3" value="0" onchange="updateCharacterSelection()">
                    </div>
                </div>
                
                <div class="character-slot">
                    <h3>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ 3</h3>
                    <div class="input-group">
                        <label>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠ</label>
                        <select id="char_2" onchange="updateCharacterSelection()">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="èŒ…æ£®æœˆæ­Œ">èŒ…æ£®æœˆæ­Œ</option>
                            <option value="å’Œæ³‰ãƒ¦ã‚­">å’Œæ³‰ãƒ¦ã‚­</option>
                            <option value="é€¢å·ã‚ãã¿">é€¢å·ã‚ãã¿</option>
                            <option value="æ±åŸã¤ã‹ã•">æ±åŸã¤ã‹ã•</option>
                            <option value="æœå€‰å¯æ†">æœå€‰å¯æ†</option>
                            <option value="åœ‹è¦‹ã‚¿ãƒ">åœ‹è¦‹ã‚¿ãƒ</option>
                            <option value="è’¼äº•ãˆã‚Šã‹">è’¼äº•ãˆã‚Šã‹</option>
                            <option value="æ°´ç€¬ã„ã¡ã”">æ°´ç€¬ã„ã¡ã”</option>
                            <option value="æ°´ç€¬ã™ã‚‚ã‚‚">æ°´ç€¬ã™ã‚‚ã‚‚</option>
                            <option value="æ¨‹å£è–è¯">æ¨‹å£è–è¯</option>
                            <option value="æŸŠæœ¨æ¢¢">æŸŠæœ¨æ¢¢</option>
                            <option value="ãƒ“ãƒ£ãƒƒã‚³">ãƒ“ãƒ£ãƒƒã‚³</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>åˆæœŸSP (åŸºæœ¬4 + è£…å‚™ + ãƒ‘ãƒƒã‚·ãƒ–)</label>
                        <input type="number" id="sp_2" min="4" max="20" value="6" onchange="updateCharacterSelection()">
                    </div>
                    <div class="input-group">
                        <label>ã‚¿ãƒ¼ãƒ³çµŒéSPè¿½åŠ ãƒœãƒ¼ãƒŠã‚¹ (åŸºæœ¬+2ã«ä¸Šä¹—ã›)</label>
                        <input type="number" id="bonus_2" min="0" max="3" value="0" onchange="updateCharacterSelection()">
                    </div>
                </div>
                
                <div class="character-slot">
                    <h3>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ 4</h3>
                    <div class="input-group">
                        <label>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠ</label>
                        <select id="char_3" onchange="updateCharacterSelection()">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="èŒ…æ£®æœˆæ­Œ">èŒ…æ£®æœˆæ­Œ</option>
                            <option value="å’Œæ³‰ãƒ¦ã‚­">å’Œæ³‰ãƒ¦ã‚­</option>
                            <option value="é€¢å·ã‚ãã¿">é€¢å·ã‚ãã¿</option>
                            <option value="æ±åŸã¤ã‹ã•">æ±åŸã¤ã‹ã•</option>
                            <option value="æœå€‰å¯æ†">æœå€‰å¯æ†</option>
                            <option value="åœ‹è¦‹ã‚¿ãƒ">åœ‹è¦‹ã‚¿ãƒ</option>
                            <option value="è’¼äº•ãˆã‚Šã‹">è’¼äº•ãˆã‚Šã‹</option>
                            <option value="æ°´ç€¬ã„ã¡ã”">æ°´ç€¬ã„ã¡ã”</option>
                            <option value="æ°´ç€¬ã™ã‚‚ã‚‚">æ°´ç€¬ã™ã‚‚ã‚‚</option>
                            <option value="æ¨‹å£è–è¯">æ¨‹å£è–è¯</option>
                            <option value="æŸŠæœ¨æ¢¢">æŸŠæœ¨æ¢¢</option>
                            <option value="ãƒ“ãƒ£ãƒƒã‚³">ãƒ“ãƒ£ãƒƒã‚³</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>åˆæœŸSP (åŸºæœ¬4 + è£…å‚™ + ãƒ‘ãƒƒã‚·ãƒ–)</label>
                        <input type="number" id="sp_3" min="4" max="20" value="6" onchange="updateCharacterSelection()">
                    </div>
                    <div class="input-group">
                        <label>ã‚¿ãƒ¼ãƒ³çµŒéSPè¿½åŠ ãƒœãƒ¼ãƒŠã‚¹ (åŸºæœ¬+2ã«ä¸Šä¹—ã›)</label>
                        <input type="number" id="bonus_3" min="0" max="3" value="0" onchange="updateCharacterSelection()">
                    </div>
                </div>
                
                <div class="character-slot">
                    <h3>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ 5</h3>
                    <div class="input-group">
                        <label>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠ</label>
                        <select id="char_4" onchange="updateCharacterSelection()">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="èŒ…æ£®æœˆæ­Œ">èŒ…æ£®æœˆæ­Œ</option>
                            <option value="å’Œæ³‰ãƒ¦ã‚­">å’Œæ³‰ãƒ¦ã‚­</option>
                            <option value="é€¢å·ã‚ãã¿">é€¢å·ã‚ãã¿</option>
                            <option value="æ±åŸã¤ã‹ã•">æ±åŸã¤ã‹ã•</option>
                            <option value="æœå€‰å¯æ†">æœå€‰å¯æ†</option>
                            <option value="åœ‹è¦‹ã‚¿ãƒ">åœ‹è¦‹ã‚¿ãƒ</option>
                            <option value="è’¼äº•ãˆã‚Šã‹">è’¼äº•ãˆã‚Šã‹</option>
                            <option value="æ°´ç€¬ã„ã¡ã”">æ°´ç€¬ã„ã¡ã”</option>
                            <option value="æ°´ç€¬ã™ã‚‚ã‚‚">æ°´ç€¬ã™ã‚‚ã‚‚</option>
                            <option value="æ¨‹å£è–è¯">æ¨‹å£è–è¯</option>
                            <option value="æŸŠæœ¨æ¢¢">æŸŠæœ¨æ¢¢</option>
                            <option value="ãƒ“ãƒ£ãƒƒã‚³">ãƒ“ãƒ£ãƒƒã‚³</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>åˆæœŸSP (åŸºæœ¬4 + è£…å‚™ + ãƒ‘ãƒƒã‚·ãƒ–)</label>
                        <input type="number" id="sp_4" min="4" max="20" value="6" onchange="updateCharacterSelection()">
                    </div>
                    <div class="input-group">
                        <label>ã‚¿ãƒ¼ãƒ³çµŒéSPè¿½åŠ ãƒœãƒ¼ãƒŠã‚¹ (åŸºæœ¬+2ã«ä¸Šä¹—ã›)</label>
                        <input type="number" id="bonus_4" min="0" max="3" value="0" onchange="updateCharacterSelection()">
                    </div>
                </div>
                
                <div class="character-slot">
                    <h3>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ 6</h3>
                    <div class="input-group">
                        <label>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠ</label>
                        <select id="char_5" onchange="updateCharacterSelection()">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            <option value="èŒ…æ£®æœˆæ­Œ">èŒ…æ£®æœˆæ­Œ</option>
                            <option value="å’Œæ³‰ãƒ¦ã‚­">å’Œæ³‰ãƒ¦ã‚­</option>
                            <option value="é€¢å·ã‚ãã¿">é€¢å·ã‚ãã¿</option>
                            <option value="æ±åŸã¤ã‹ã•">æ±åŸã¤ã‹ã•</option>
                            <option value="æœå€‰å¯æ†">æœå€‰å¯æ†</option>
                            <option value="åœ‹è¦‹ã‚¿ãƒ">åœ‹è¦‹ã‚¿ãƒ</option>
                            <option value="è’¼äº•ãˆã‚Šã‹">è’¼äº•ãˆã‚Šã‹</option>
                            <option value="æ°´ç€¬ã„ã¡ã”">æ°´ç€¬ã„ã¡ã”</option>
                            <option value="æ°´ç€¬ã™ã‚‚ã‚‚">æ°´ç€¬ã™ã‚‚ã‚‚</option>
                            <option value="æ¨‹å£è–è¯">æ¨‹å£è–è¯</option>
                            <option value="æŸŠæœ¨æ¢¢">æŸŠæœ¨æ¢¢</option>
                            <option value="ãƒ“ãƒ£ãƒƒã‚³">ãƒ“ãƒ£ãƒƒã‚³</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>åˆæœŸSP (åŸºæœ¬4 + è£…å‚™ + ãƒ‘ãƒƒã‚·ãƒ–)</label>
                        <input type="number" id="sp_5" min="4" max="20" value="6" onchange="updateCharacterSelection()">
                    </div>
                    <div class="input-group">
                        <label>ã‚¿ãƒ¼ãƒ³çµŒéSPè¿½åŠ ãƒœãƒ¼ãƒŠã‚¹ (åŸºæœ¬+2ã«ä¸Šä¹—ã›)</label>
                        <input type="number" id="bonus_5" min="0" max="3" value="0" onchange="updateCharacterSelection()">
                    </div>
                </div>
            </div>
            <div class="controls">
                <button class="btn btn-primary" onclick="loadPartySetup()">ç·¨æˆç¢ºå®š</button>
                <button class="btn btn-warning" onclick="resetParty()">ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
        </div>
        
        <!-- ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼è¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="party-display">
            <h2>âš”ï¸ æˆ¦é—˜ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</h2>
            <div class="turn-info" id="turnInfo">
                ã‚¿ãƒ¼ãƒ³ 1 - æˆ¦é—˜æº–å‚™ä¸­
            </div>
            <div class="position-labels">
                <div class="position-label front">å‰è¡› 1</div>
                <div class="position-label front">å‰è¡› 2</div>
                <div class="position-label front">å‰è¡› 3</div>
                <div class="position-label back">å¾Œè¡› 4</div>
                <div class="position-label back">å¾Œè¡› 5</div>
                <div class="position-label back">å¾Œè¡› 6</div>
            </div>
            <div class="party-formation" id="partyFormation">
                <div class="character-card front" id="char_card_0" onclick="handleCharacterClick(0)">
                    <span>æœªè¨­å®š</span>
                    <div class="sp-display">0</div>
                </div>
                <div class="character-card front" id="char_card_1" onclick="handleCharacterClick(1)">
                    <span>æœªè¨­å®š</span>
                    <div class="sp-display">0</div>
                </div>
                <div class="character-card front" id="char_card_2" onclick="handleCharacterClick(2)">
                    <span>æœªè¨­å®š</span>
                    <div class="sp-display">0</div>
                </div>
                <div class="character-card back" id="char_card_3" onclick="handleCharacterClick(3)">
                    <span>æœªè¨­å®š</span>
                    <div class="sp-display">0</div>
                </div>
                <div class="character-card back" id="char_card_4" onclick="handleCharacterClick(4)">
                    <span>æœªè¨­å®š</span>
                    <div class="sp-display">0</div>
                </div>
                <div class="character-card back" id="char_card_5" onclick="handleCharacterClick(5)">
                    <span>æœªè¨­å®š</span>
                    <div class="sp-display">0</div>
                </div>
            </div>
        </div>
        
        <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« -->
        <div class="control-panel">
            <h2>ğŸ® æˆ¦é—˜ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h2>
            <div class="controls">
                <button class="btn btn-warning" id="swapBtn" onclick="toggleSwapMode()">é…ç½®å…¥ã‚Œæ›¿ãˆ</button>
                <button class="btn btn-success" id="executeBtn" onclick="executeTurn()" disabled>ã‚¿ãƒ¼ãƒ³å®Ÿè¡Œ</button>
                <button class="btn btn-primary" onclick="nextTurn()">æ¬¡ã®ã‚¿ãƒ¼ãƒ³</button>
            </div>
            
            <!-- ã‚¹ã‚­ãƒ«é¸æŠã‚¨ãƒªã‚¢ -->
            <div class="skill-selection" id="skillSelection" style="display: none;">
                <h3 id="skillSelectionTitle">ã‚¹ã‚­ãƒ«é¸æŠ</h3>
                <select class="skill-dropdown" id="skillDropdown" onchange="selectSkill()">
                    <option value="">ã‚¹ã‚­ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                </select>
            </div>
        </div>
        
        <!-- çµæœè¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="results-section">
            <h2>ğŸ“Š æˆ¦é—˜çµæœ</h2>
            <div id="resultsContainer">
                <table class="results-table" id="resultsTable">
                    <thead>
                        <tr>
                            <th>ã‚¿ãƒ¼ãƒ³</th>
                            <th>æ•µè¡Œå‹•ãªã©</th>
                            <th colspan="3">ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼1</th>
                            <th colspan="3">ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼2</th>
                            <th colspan="3">ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼3</th>
                            <th colspan="3">ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼4</th>
                            <th colspan="3">ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼5</th>
                            <th colspan="3">ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼6</th>
                        </tr>
                        <tr>
                            <th></th>
                            <th></th>
                            <th>å§‹</th><th>è¡Œå‹•</th><th>çµ‚</th>
                            <th>å§‹</th><th>è¡Œå‹•</th><th>çµ‚</th>
                            <th>å§‹</th><th>è¡Œå‹•</th><th>çµ‚</th>
                            <th>å§‹</th><th>è¡Œå‹•</th><th>çµ‚</th>
                            <th>å§‹</th><th>è¡Œå‹•</th><th>çµ‚</th>
                            <th>å§‹</th><th>è¡Œå‹•</th><th>çµ‚</th>
                        </tr>
                    </thead>
                    <tbody id="resultsBody">
                        <!-- çµæœè¡ŒãŒJavaScriptã§ç”Ÿæˆã•ã‚Œã‚‹ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let characterDatabase = {};
        let currentParty = [];
        let currentTurn = 1;
        let isSwapMode = false;
        let swapFirstSelected = null;
        let selectedCharacterForSkill = null;
        let turnActions = {};
        let battleHistory = [];
        let positionMap = [0, 1, 2, 3, 4, 5]; // ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒãƒƒãƒ—
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('GUIåˆæœŸåŒ–é–‹å§‹');
            // ã¾ãšJSONãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã‚’è©¦è¡Œ
            loadSkillData();
        });
        
        // skill.jsonãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
        async function loadSkillData() {
            try {
                // skillDatabase.jsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿
                const response = await fetch('skillDatabase.json');
                const jsonData = await response.json();
                
                characterDatabase = jsonData.characters;
                
                if (Object.keys(characterDatabase).length === 0) {
                    throw new Error('JSONãƒ‡ãƒ¼ã‚¿ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
                
                console.log('ã‚¹ã‚­ãƒ«ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†:', Object.keys(characterDatabase).length, 'ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼');
                console.log('åˆ©ç”¨å¯èƒ½ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼:', Object.keys(characterDatabase));
                
                // HTMLã®åˆæœŸã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠè‚¢ã‚’æ›´æ–°
                updateCharacterOptions();
                
            } catch (error) {
                console.warn('skillDatabase.jsonã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ¨¡æ“¬ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¾ã™:', error);
                loadMockData();
            }
        }
        
        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠè‚¢ã®æ›´æ–°
        function updateCharacterOptions() {
            const characters = Object.keys(characterDatabase);
            
            for (let i = 0; i < 6; i++) {
                const select = document.getElementById(`char_${i}`);
                if (select) {
                    // æ—¢å­˜ã®é¸æŠå€¤ã‚’ä¿æŒ
                    const currentValue = select.value;
                    
                    // ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°
                    select.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>';
                    characters.forEach(char => {
                        const option = document.createElement('option');
                        option.value = char;
                        option.textContent = char;
                        if (char === currentValue) {
                            option.selected = true;
                        }
                        select.appendChild(option);
                    });
                }
            }
            
            // é‡è¤‡ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
            updateCharacterSelection();
        }
        
        // æ¨¡æ“¬ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ï¼ˆskillDatabase.jsonãŒåˆ©ç”¨ã§ããªã„å ´åˆï¼‰
        function loadMockData() {
            characterDatabase = {
                "èŒ…æ£®æœˆæ­Œ": [
                    {name: "é€šå¸¸æ”»æ’ƒ", cost: 0, type: "damage"},
                    {name: "ã”æ³¨æ–‡ã‚’ã©ã†ãâ™ª", cost: 4, type: "damage"},
                    {name: "é’æ˜¥è‰²ã®ãƒ¡ãƒ­ãƒ‡ã‚£", cost: 6, type: "damage"},
                    {name: "ç™’ã—ã®æ­Œå£°", cost: 3, type: "non_damage"}
                ],
                "å’Œæ³‰ãƒ¦ã‚­": [
                    {name: "é€šå¸¸æ”»æ’ƒ", cost: 0, type: "damage"},
                    {name: "ãƒ–ãƒ¬ã‚¤ã‚¯ã‚«ãƒãƒ³", cost: 7, type: "damage"},
                    {name: "ç²¾å¯†å°„æ’ƒ", cost: 5, type: "damage"},
                    {name: "å¿œæ´", cost: 2, type: "non_damage"}
                ],
                "é€¢å·ã‚ãã¿": [
                    {name: "é€šå¸¸æ”»æ’ƒ", cost: 0, type: "damage"},
                    {name: "ã‚¹ã‚¿ãƒ³ãƒ–ãƒ¬ãƒ¼ãƒ‰", cost: 5, type: "damage"},
                    {name: "ãƒ‘ãƒ¯ãƒ¼ãƒãƒ£ãƒ¼ã‚¸", cost: 3, type: "non_damage"}
                ],
                "æ±åŸã¤ã‹ã•": [
                    {name: "é€šå¸¸æ”»æ’ƒ", cost: 0, type: "damage"},
                    {name: "å°‚ç”¨ã‚¹ã‚­ãƒ«", cost: 4, type: "damage"},
                    {name: "å›å¾©", cost: 3, type: "non_damage"}
                ],
                "æœå€‰å¯æ†": [
                    {name: "é€šå¸¸æ”»æ’ƒ", cost: 0, type: "damage"},
                    {name: "ä¸€é–ƒ", cost: 6, type: "damage"},
                    {name: "é€£ç¶šæ–¬", cost: 4, type: "damage"}
                ],
                "åœ‹è¦‹ã‚¿ãƒ": [
                    {name: "é€šå¸¸æ”»æ’ƒ", cost: 0, type: "damage"},
                    {name: "OTR", cost: 8, type: "damage"},
                    {name: "å®ˆè­·", cost: 2, type: "non_damage"}
                ],
                "è’¼äº•ãˆã‚Šã‹": [
                    {name: "é€šå¸¸æ”»æ’ƒ", cost: 0, type: "damage"},
                    {name: "é’æ˜¥ã‚¹ãƒãƒƒã‚·ãƒ¥", cost: 5, type: "damage"},
                    {name: "å…ƒæ°—æ³¨å…¥", cost: 3, type: "non_damage"}
                ],
                "æ°´ç€¬ã„ã¡ã”": [
                    {name: "é€šå¸¸æ”»æ’ƒ", cost: 0, type: "damage"},
                    {name: "ã‚¢ã‚¤ã‚¹ã‚¹ãƒ©ãƒƒã‚·ãƒ¥", cost: 4, type: "damage"},
                    {name: "å†·å´", cost: 2, type: "non_damage"}
                ],
                "æ°´ç€¬ã™ã‚‚ã‚‚": [
                    {name: "é€šå¸¸æ”»æ’ƒ", cost: 0, type: "damage"},
                    {name: "ãƒ•ã‚¡ã‚¤ã‚¢ãƒ–ãƒ©ã‚¹ãƒˆ", cost: 6, type: "damage"},
                    {name: "ç‚ã®å¿œæ´", cost: 3, type: "non_damage"}
                ],
                "æ¨‹å£è–è¯": [
                    {name: "é€šå¸¸æ”»æ’ƒ", cost: 0, type: "damage"},
                    {name: "ãƒˆãƒªãƒƒã‚¯ãƒ»ã‚«ãƒãƒ³", cost: 13, type: "damage"},
                    {name: "ç‹™æ’ƒ", cost: 4, type: "damage"}
                ],
                "æŸŠæœ¨æ¢¢": [
                    {name: "é€šå¸¸æ”»æ’ƒ", cost: 0, type: "damage"},
                    {name: "ã‚¯ãƒ¬ãƒ¼ãƒ«", cost: 8, type: "damage"},
                    {name: "å®ˆè­·ã®ç¥ˆã‚Š", cost: 2, type: "non_damage"}
                ],
                "ãƒ“ãƒ£ãƒƒã‚³": [
                    {name: "é€šå¸¸æ”»æ’ƒ", cost: 0, type: "damage"},
                    {name: "ç£ç‹æ’ƒ", cost: 7, type: "damage"},
                    {name: "å’†å“®", cost: 3, type: "non_damage"}
                ]
            };
            
            console.log('æ¨¡æ“¬ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†:', Object.keys(characterDatabase).length, 'ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼');
            console.log('æ¨¡æ“¬ãƒ‡ãƒ¼ã‚¿ã‚µãƒ³ãƒ—ãƒ«:', characterDatabase["èŒ…æ£®æœˆæ­Œ"]);
            updateCharacterOptions();
        }
        
        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šUIã®ç”Ÿæˆ
        function generateCharacterConfig() {
            const container = document.getElementById('characterConfig');
            container.innerHTML = ''; // æ—¢å­˜ã®å†…å®¹ã‚’ã‚¯ãƒªã‚¢
            
            const characters = Object.keys(characterDatabase);
            console.log('åˆ©ç”¨å¯èƒ½ãªã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼:', characters);
            
            if (characters.length === 0) {
                container.innerHTML = '<div class="loading">ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>';
                return;
            }
            
            for (let i = 0; i < 6; i++) {
                const slot = document.createElement('div');
                slot.className = 'character-slot';
                slot.innerHTML = `
                    <h3>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ ${i + 1}</h3>
                    <div class="input-group">
                        <label>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠ</label>
                        <select id="char_${i}" onchange="updateCharacterSelection()">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                            ${characters.map(char => `<option value="${char}">${char}</option>`).join('')}
                        </select>
                    </div>
                    <div class="input-group">
                        <label>åˆæœŸSP (åŸºæœ¬4 + è£…å‚™ + ãƒ‘ãƒƒã‚·ãƒ–)</label>
                        <input type="number" id="sp_${i}" min="4" max="20" value="6" onchange="updateCharacterSelection()">
                    </div>
                    <div class="input-group">
                        <label>ã‚¿ãƒ¼ãƒ³çµŒéSPè¿½åŠ ãƒœãƒ¼ãƒŠã‚¹ (åŸºæœ¬+2ã«ä¸Šä¹—ã›)</label>
                        <input type="number" id="bonus_${i}" min="0" max="3" value="0" onchange="updateCharacterSelection()">
                    </div>
                `;
                container.appendChild(slot);
            }
            
            console.log('ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šUIç”Ÿæˆå®Œäº†');
        }
        
        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠã®æ›´æ–°ï¼ˆé‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼‰
        function updateCharacterSelection() {
            const selectedChars = [];
            for (let i = 0; i < 6; i++) {
                const select = document.getElementById(`char_${i}`);
                if (select && select.value) {
                    selectedChars.push(select.value);
                }
            }
            
            // é‡è¤‡ãƒã‚§ãƒƒã‚¯
            for (let i = 0; i < 6; i++) {
                const select = document.getElementById(`char_${i}`);
                if (!select) continue;
                
                const options = select.querySelectorAll('option');
                
                options.forEach(option => {
                    if (option.value && option.value !== select.value) {
                        const duplicateCount = selectedChars.filter(c => c === option.value).length;
                        option.disabled = duplicateCount > 0;
                    } else {
                        option.disabled = false;
                    }
                });
            }
            
            // ãƒ‡ãƒãƒƒã‚°ç”¨
            console.log('é¸æŠä¸­ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼:', selectedChars);
        }
        
        // ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ç·¨æˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æŠ˜ã‚ŠãŸãŸã¿åˆ‡ã‚Šæ›¿ãˆ
        function togglePartySetup() {
            const partySetup = document.getElementById('partySetup');
            partySetup.classList.toggle('collapsed');
            
            console.log('ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ç·¨æˆã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆ');
        }
        
        // ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼è¨­å®šã®ãƒ­ãƒ¼ãƒ‰
        function loadPartySetup() {
            currentParty = [];
            let hasIncompleteSelection = false;
            
            for (let i = 0; i < 6; i++) {
                const charSelect = document.getElementById(`char_${i}`);
                const spInput = document.getElementById(`sp_${i}`);
                const bonusInput = document.getElementById(`bonus_${i}`);
                
                const charName = charSelect ? charSelect.value : '';
                const initialSP = spInput ? (parseInt(spInput.value) || 6) : 6;
                const spBonus = bonusInput ? (parseInt(bonusInput.value) || 0) : 0;
                
                if (!charName) {
                    alert(`ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ ${i + 1} ã‚’é¸æŠã—ã¦ãã ã•ã„`);
                    hasIncompleteSelection = true;
                    break;
                }
                
                if (!characterDatabase[charName]) {
                    alert(`ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ "${charName}" ã®ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
                    hasIncompleteSelection = true;
                    break;
                }
                
                currentParty.push({
                    name: charName,
                    initialSP: initialSP,
                    currentSP: initialSP,
                    spBonus: spBonus,
                    position: i,
                    skills: characterDatabase[charName] || []
                });
            }
            
            if (hasIncompleteSelection) {
                return;
            }
            
            // æˆåŠŸæ™‚ã®å‡¦ç†
            console.log('ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ç·¨æˆå®Œäº†:', currentParty);
            console.log('å„ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ã‚¹ã‚­ãƒ«ç¢ºèª:');
            currentParty.forEach((player, index) => {
                console.log(`${index + 1}. ${player.name}:`, {
                    skillCount: player.skills.length,
                    skills: player.skills.map(s => `${s.name}(${s.cost}SP)`),
                    currentSP: player.currentSP
                });
            });
            
            generatePartyDisplay();
            updateResultsTableHeaders();
            
            // ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ç·¨æˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è‡ªå‹•çš„ã«æŠ˜ã‚ŠãŸãŸã‚€
            const partySetup = document.getElementById('partySetup');
            partySetup.classList.add('collapsed');
            
            // ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼çŠ¶æ³ã‚’æ›´æ–°
            const partyStatus = document.getElementById('partyStatus');
            const selectedNames = currentParty.map(p => p.name).join(', ');
            partyStatus.textContent = `âœ… ç·¨æˆå®Œäº†: ${selectedNames}`;
            
            // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            alert('ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ç·¨æˆãŒå®Œäº†ã—ã¾ã—ãŸï¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒæŠ˜ã‚ŠãŸãŸã¾ã‚Œã¾ã—ãŸã€‚');
        }
        
        // ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼è¡¨ç¤ºã®ç”Ÿæˆ
        function generatePartyDisplay() {
            const container = document.getElementById('partyFormation');
            container.innerHTML = '';
            
            if (currentParty.length === 0) {
                container.innerHTML = '<div class="loading">ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ä¸Šéƒ¨ã§ç·¨æˆã‚’ç¢ºå®šã—ã¦ãã ã•ã„ã€‚</div>';
                return;
            }
            
            for (let i = 0; i < 6; i++) {
                const playerIndex = positionMap[i];
                const character = currentParty[playerIndex];
                
                // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠ
                const characterContainer = document.createElement('div');
                characterContainer.className = 'character-container';
                
                // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚«ãƒ¼ãƒ‰
                const card = document.createElement('div');
                card.className = `character-card ${i < 3 ? 'front' : 'back'}`;
                card.id = `char_card_${i}`;
                card.onclick = () => handleCharacterClick(i);
                card.textContent = character ? character.name : 'æœªè¨­å®š';
                
                // SPè¡¨ç¤º
                const spDisplay = document.createElement('div');
                spDisplay.className = 'sp-display';
                spDisplay.textContent = character ? character.currentSP : '0';
                card.appendChild(spDisplay);
                
                // ã‚¹ã‚­ãƒ«è¡¨ç¤ºï¼ˆã‚«ãƒ¼ãƒ‰ã®ä¸‹ã«ç‹¬ç«‹é…ç½®ï¼‰
                const skillDisplay = document.createElement('div');
                skillDisplay.className = 'skill-display inactive';
                skillDisplay.id = `skill_display_${i}`;
                
                if (character && i < 3) {
                    // å‰è¡›ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ã‚­ãƒ«é¸æŠï¼ˆé€šå¸¸æ”»æ’ƒ cost0ï¼‰
                    if (!turnActions[i]) {
                        const defaultSkill = character.skills.find(skill => skill.cost === 0);
                        if (defaultSkill) {
                            turnActions[i] = {
                                character: character.name,
                                skill: defaultSkill,
                                position: i
                            };
                            console.log(`åˆæœŸãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ã‚­ãƒ«è¨­å®š: ${character.name} â†’ ${defaultSkill.name}`);
                        } else {
                            console.warn(`${character.name} ã«é€šå¸¸æ”»æ’ƒ(cost0)ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
                        }
                    }
                    updateSkillDisplayElement(skillDisplay, i);
                } else if (i >= 3) {
                    // å¾Œè¡›ã®å ´åˆ
                    skillDisplay.textContent = 'å¾Œè¡›å¾…æ©Ÿ';
                    skillDisplay.className = 'skill-display inactive';
                } else {
                    // æœªè¨­å®šã®å ´åˆ
                    skillDisplay.textContent = 'æœªè¨­å®š';
                    skillDisplay.className = 'skill-display inactive';
                }
                
                characterContainer.appendChild(card);
                characterContainer.appendChild(skillDisplay);
                container.appendChild(characterContainer);
            }
            
            updateExecuteButton();
            console.log('ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼è¡¨ç¤ºæ›´æ–°å®Œäº†');
        }
        
        // ã‚¹ã‚­ãƒ«è¡¨ç¤ºè¦ç´ ã®æ›´æ–°
        function updateSkillDisplayElement(skillElement, position) {
            if (turnActions[position]) {
                const action = turnActions[position];
                const skillName = action.skill.name;
                const skillCost = action.skill.cost;
                
                // ã‚¹ã‚­ãƒ«åãŒé•·ã„å ´åˆã¯çŸ­ç¸®
                let displayName = skillName;
                if (skillName.length > 10) {
                    displayName = skillName.substring(0, 8) + '...';
                }
                
                skillElement.textContent = `${displayName} (${skillCost})`;
                skillElement.className = skillCost === 0 ? 'skill-display default' : 'skill-display special';
            } else {
                skillElement.textContent = 'ã‚¹ã‚­ãƒ«æœªé¸æŠ';
                skillElement.className = 'skill-display inactive';
            }
        }
        
        // ã‚¹ã‚­ãƒ«è¡¨ç¤ºã®æ›´æ–°ï¼ˆæ—¢å­˜ã®IDãƒ™ãƒ¼ã‚¹é–¢æ•°ï¼‰
        function updateSkillDisplay(position) {
            const skillDisplay = document.getElementById(`skill_display_${position}`);
            if (skillDisplay) {
                updateSkillDisplayElement(skillDisplay, position);
            }
        }
        
        // ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½
        function resetParty() {
            if (confirm('ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                currentParty = [];
                currentTurn = 1;
                battleHistory = [];
                turnActions = {};
                positionMap = [0, 1, 2, 3, 4, 5];
                
                // UIè¦ç´ ã®ãƒªã‚»ãƒƒãƒˆ
                for (let i = 0; i < 6; i++) {
                    const charSelect = document.getElementById(`char_${i}`);
                    const spInput = document.getElementById(`sp_${i}`);
                    const bonusInput = document.getElementById(`bonus_${i}`);
                    
                    if (charSelect) charSelect.value = '';
                    if (spInput) spInput.value = '6';
                    if (bonusInput) bonusInput.value = '0';
                }
                
                updateCharacterSelection();
                generatePartyDisplay();
                document.getElementById('turnInfo').textContent = 'ã‚¿ãƒ¼ãƒ³ 1 - æˆ¦é—˜æº–å‚™ä¸­';
                document.getElementById('resultsBody').innerHTML = '';
                
                console.log('ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ãƒªã‚»ãƒƒãƒˆå®Œäº†');
            }
        }
        
        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
        function handleCharacterClick(position) {
            if (isSwapMode) {
                handleSwapClick(position);
            } else {
                handleSkillSelection(position);
            }
        }
        
        // é…ç½®å…¥ã‚Œæ›¿ãˆãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆ
        function toggleSwapMode() {
            isSwapMode = !isSwapMode;
            const btn = document.getElementById('swapBtn');
            
            if (isSwapMode) {
                btn.textContent = 'å…¥ã‚Œæ›¿ãˆä¸­æ­¢';
                btn.className = 'btn btn-warning';
                document.querySelectorAll('.character-card').forEach(card => {
                    card.classList.add('swap-mode');
                });
            } else {
                btn.textContent = 'é…ç½®å…¥ã‚Œæ›¿ãˆ';
                btn.className = 'btn btn-warning';
                swapFirstSelected = null;
                document.querySelectorAll('.character-card').forEach(card => {
                    card.classList.remove('swap-mode', 'selected');
                });
            }
        }
        
        // é…ç½®å…¥ã‚Œæ›¿ãˆå‡¦ç†
        function handleSwapClick(position) {
            if (swapFirstSelected === null) {
                swapFirstSelected = position;
                document.getElementById(`char_card_${position}`).classList.add('selected');
            } else {
                if (swapFirstSelected !== position) {
                    // ä½ç½®ã‚’äº¤æ›
                    [positionMap[swapFirstSelected], positionMap[position]] = 
                    [positionMap[position], positionMap[swapFirstSelected]];
                    
                    // ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼è¡¨ç¤ºã‚’æ›´æ–°
                    generatePartyDisplay();
                }
                
                // å…¥ã‚Œæ›¿ãˆãƒ¢ãƒ¼ãƒ‰çµ‚äº†
                toggleSwapMode();
            }
        }
        
        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
        function handleCharacterClick(position) {
            if (isSwapMode) {
                handleSwap(position);
            } else {
                handleSkillSelection(position);
            }
        }
        
        // ã‚¹ã‚­ãƒ«é¸æŠå‡¦ç†
        function handleSkillSelection(position) {
            const playerIndex = positionMap[position];
            const character = currentParty[playerIndex];
            
            console.log('ã‚¹ã‚­ãƒ«é¸æŠé–‹å§‹:', {
                position,
                playerIndex,
                character: character ? character.name : 'ãªã—',
                skills: character ? character.skills : 'ãªã—',
                skillCount: character ? character.skills.length : 0,
                isFrontLine: position < 3
            });
            
            if (!character || position >= 3) { // å‰è¡›ã®ã¿ã‚¹ã‚­ãƒ«é¸æŠå¯èƒ½
                console.log('ã‚¹ã‚­ãƒ«é¸æŠä¸å¯:', position >= 3 ? 'å¾Œè¡›' : 'æœªè¨­å®š');
                return;
            }
            
            selectedCharacterForSkill = position;
            
            const skillSelection = document.getElementById('skillSelection');
            const skillTitle = document.getElementById('skillSelectionTitle');
            const skillDropdown = document.getElementById('skillDropdown');
            
            skillTitle.textContent = `${character.name} ã®ã‚¹ã‚­ãƒ«é¸æŠ`;
            skillDropdown.innerHTML = '<option value="">ã‚¹ã‚­ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„</option>';
            
            console.log('ã‚¹ã‚­ãƒ«ãƒªã‚¹ãƒˆ:', character.skills);
            
            character.skills.forEach((skill, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${skill.name} (SP:${skill.cost})`;
                option.disabled = skill.cost > character.currentSP;
                skillDropdown.appendChild(option);
                
                console.log(`ã‚¹ã‚­ãƒ«è¿½åŠ : ${skill.name} (SP:${skill.cost}) ${option.disabled ? '[ä½¿ç”¨ä¸å¯]' : '[ä½¿ç”¨å¯]'}`);
            });
            
            // ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹ã‚¹ã‚­ãƒ«ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            if (turnActions[position]) {
                const currentSkillIndex = character.skills.findIndex(skill => 
                    skill.name === turnActions[position].skill.name && 
                    skill.cost === turnActions[position].skill.cost
                );
                if (currentSkillIndex >= 0) {
                    skillDropdown.value = currentSkillIndex;
                }
            }
            
            skillSelection.style.display = 'block';
            
            // é¸æŠã•ã‚ŒãŸçŠ¶æ…‹ã‚’è¡¨ç¤º
            document.querySelectorAll('.character-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.getElementById(`char_card_${position}`).classList.add('selected');
            
            console.log('ã‚¹ã‚­ãƒ«é¸æŠUIè¡¨ç¤ºå®Œäº†');
        }
        
        // ã‚¹ã‚­ãƒ«é¸æŠ
        function selectSkill() {
            const skillDropdown = document.getElementById('skillDropdown');
            const skillIndex = skillDropdown.value;
            
            console.log('ã‚¹ã‚­ãƒ«é¸æŠå®Ÿè¡Œ:', {
                selectedCharacterForSkill,
                skillIndex,
                dropdownValue: skillDropdown.value
            });
            
            if (skillIndex !== '' && selectedCharacterForSkill !== null) {
                const playerIndex = positionMap[selectedCharacterForSkill];
                const character = currentParty[playerIndex];
                const skill = character.skills[skillIndex];
                
                console.log('ã‚¹ã‚­ãƒ«é¸æŠè©³ç´°:', {
                    character: character.name,
                    skill: skill.name,
                    cost: skill.cost,
                    position: selectedCharacterForSkill
                });
                
                turnActions[selectedCharacterForSkill] = {
                    character: character.name,
                    skill: skill,
                    position: selectedCharacterForSkill
                };
                
                // UIæ›´æ–°
                const card = document.getElementById(`char_card_${selectedCharacterForSkill}`);
                card.style.border = '3px solid #4ade80';
                
                // ã‚¹ã‚­ãƒ«è¡¨ç¤ºæ›´æ–°
                updateSkillDisplay(selectedCharacterForSkill);
                
                // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‰ã˜ã‚‹
                document.getElementById('skillSelection').style.display = 'none';
                
                // é¸æŠçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
                document.querySelectorAll('.character-card').forEach(card => {
                    card.classList.remove('selected');
                });
                
                selectedCharacterForSkill = null;
                
                updateExecuteButton();
                
                console.log(`ã‚¹ã‚­ãƒ«é¸æŠå®Œäº†: ${character.name} â†’ ${skill.name} (SP:${skill.cost})`);
            } else {
                console.log('ã‚¹ã‚­ãƒ«é¸æŠå¤±æ•—: ç„¡åŠ¹ãªé¸æŠ', {
                    skillIndex,
                    selectedCharacterForSkill
                });
            }
        }
        
        // å®Ÿè¡Œãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
        function updateExecuteButton() {
            const frontPositions = [0, 1, 2];
            const executeBtn = document.getElementById('executeBtn');
            
            let allActionsReady = true;
            let debugInfo = [];
            
            frontPositions.forEach(pos => {
                const playerIndex = positionMap[pos];
                const character = currentParty[playerIndex];
                const hasAction = turnActions[pos];
                
                debugInfo.push({
                    position: pos,
                    character: character ? character.name : 'æœªè¨­å®š',
                    hasAction: !!hasAction,
                    action: hasAction ? `${hasAction.skill.name}(${hasAction.skill.cost})` : 'ãªã—'
                });
                
                if (character && !hasAction) {
                    allActionsReady = false;
                }
            });
            
            console.log('å®Ÿè¡Œãƒœã‚¿ãƒ³çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯:', {
                allActionsReady,
                details: debugInfo,
                turnActionsCount: Object.keys(turnActions).length
            });
            
            if (executeBtn) {
                executeBtn.disabled = !allActionsReady;
                console.log('å®Ÿè¡Œãƒœã‚¿ãƒ³çŠ¶æ…‹:', allActionsReady ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹');
            }
        }
        
        // ã‚¿ãƒ¼ãƒ³å®Ÿè¡Œ
        function executeTurn() {
            const turnData = {
                turn: currentTurn,
                enemyAction: "æ•µè¡Œå‹•",
                characters: []
            };
            
            // SPå›å¾©ã¨ã‚¿ãƒ¼ãƒ³å‡¦ç†
            currentParty.forEach((character, index) => {
                if (!character) return;
                
                const startSP = character.currentSP;
                
                // ã‚¿ãƒ¼ãƒ³é–‹å§‹æ™‚SPå›å¾©
                character.currentSP += 2 + character.spBonus;
                character.currentSP = Math.min(character.currentSP, 20);
                
                // è¡Œå‹•å‡¦ç†
                const position = positionMap.indexOf(index);
                let action = "å¾…æ©Ÿ";
                let endSP = character.currentSP;
                
                if (position < 3 && turnActions[position]) {
                    const skillData = turnActions[position].skill;
                    action = skillData.name;
                    endSP = character.currentSP - skillData.cost;
                    character.currentSP = endSP;
                }
                
                turnData.characters.push({
                    name: character.name,
                    startSP: character.currentSP + (turnActions[positionMap.indexOf(index)]?.skill?.cost || 0) - 2 - character.spBonus,
                    action: action,
                    endSP: character.currentSP
                });
            });
            
            battleHistory.push(turnData);
            updateResultsTable();
            generatePartyDisplay();
            
            // ãƒªã‚»ãƒƒãƒˆ
            turnActions = {};
            document.querySelectorAll('.character-card').forEach(card => {
                card.style.border = '';
                card.classList.remove('selected');
            });
            
            // å‰è¡›ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ã‚­ãƒ«å†è¨­å®š
            for (let i = 0; i < 3; i++) {
                const playerIndex = positionMap[i];
                const character = currentParty[playerIndex];
                if (character) {
                    const defaultSkill = character.skills.find(skill => skill.cost === 0);
                    if (defaultSkill) {
                        turnActions[i] = {
                            character: character.name,
                            skill: defaultSkill,
                            position: i
                        };
                        console.log(`ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ã‚­ãƒ«å†è¨­å®š: ${character.name} â†’ ${defaultSkill.name}`);
                    }
                    // ã‚¹ã‚­ãƒ«è¡¨ç¤ºã‚’æ›´æ–°
                    updateSkillDisplay(i);
                }
            }
            
            updateExecuteButton();
            console.log('ã‚¿ãƒ¼ãƒ³å®Ÿè¡Œå¾Œã®ãƒªã‚»ãƒƒãƒˆå®Œäº†');
        }
        
        // æ¬¡ã®ã‚¿ãƒ¼ãƒ³
        function nextTurn() {
            currentTurn++;
            document.getElementById('turnInfo').textContent = `ã‚¿ãƒ¼ãƒ³ ${currentTurn} - æˆ¦é—˜ä¸­`;
        }
        
        // çµæœãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ˜ãƒƒãƒ€ãƒ¼æ›´æ–°
        function updateResultsTableHeaders() {
            const headerRow = document.querySelector('.results-table thead tr:first-child');
            const subHeaderRow = document.querySelector('.results-table thead tr:last-child');
            
            if (!headerRow || !subHeaderRow) return;
            
            // ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å‹•çš„ã«æ›´æ–°
            headerRow.innerHTML = `
                <th>ã‚¿ãƒ¼ãƒ³</th>
                <th>æ•µè¡Œå‹•ãªã©</th>
                ${currentParty.map(char => `<th colspan="3">${char.name}</th>`).join('')}
            `;
            
            subHeaderRow.innerHTML = `
                <th></th>
                <th></th>
                ${currentParty.map(() => '<th>å§‹</th><th>è¡Œå‹•</th><th>çµ‚</th>').join('')}
            `;
        }
        
        // çµæœãƒ†ãƒ¼ãƒ–ãƒ«ã®æ›´æ–°
        function updateResultsTable() {
            const tbody = document.getElementById('resultsBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            battleHistory.forEach(turn => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${turn.turn}</td>
                    <td>${turn.enemyAction}</td>
                    ${turn.characters.map(char => 
                        `<td>${char.startSP}</td><td>${char.action}</td><td>${char.endSP}</td>`
                    ).join('')}
                `;
                tbody.appendChild(row);
            });
        }
        
        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚«ãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
        function handleCharacterClick(position) {
            if (isSwapMode) {
                handleSwapClick(position);
            } else {
                handleSkillSelection(position);
            }
        }
        
        // é…ç½®å…¥ã‚Œæ›¿ãˆãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆ
        function toggleSwapMode() {
            isSwapMode = !isSwapMode;
            const btn = document.getElementById('swapBtn');
            
            if (isSwapMode) {
                btn.textContent = 'å…¥ã‚Œæ›¿ãˆä¸­æ­¢';
                btn.className = 'btn btn-warning';
                document.querySelectorAll('.character-card').forEach(card => {
                    card.classList.add('swap-mode');
                });
            } else {
                btn.textContent = 'é…ç½®å…¥ã‚Œæ›¿ãˆ';
                btn.className = 'btn btn-warning';
                swapFirstSelected = null;
                document.querySelectorAll('.character-card').forEach(card => {
                    card.classList.remove('swap-mode', 'selected');
                });
            }
        }
        
        // é…ç½®å…¥ã‚Œæ›¿ãˆå‡¦ç†
        function handleSwapClick(position) {
            if (swapFirstSelected === null) {
                swapFirstSelected = position;
                document.getElementById(`char_card_${position}`).classList.add('selected');
            } else {
                if (swapFirstSelected !== position) {
                    // ä½ç½®ã‚’äº¤æ›
                    [positionMap[swapFirstSelected], positionMap[position]] = 
                    [positionMap[position], positionMap[swapFirstSelected]];
                    
                    // ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼è¡¨ç¤ºã‚’æ›´æ–°
                    generatePartyDisplay();
                }
                
                // å…¥ã‚Œæ›¿ãˆãƒ¢ãƒ¼ãƒ‰çµ‚äº†
                toggleSwapMode();
            }
        }
        
        // ã‚¹ã‚­ãƒ«é¸æŠå‡¦ç†
        function handleSkillSelection(position) {
            if (isSwapMode) return;
            
            const playerIndex = positionMap[position];
            const character = currentParty[playerIndex];
            
            if (!character || position >= 3) { // å‰è¡›ã®ã¿ã‚¹ã‚­ãƒ«é¸æŠå¯èƒ½
                return;
            }
            
            selectedCharacterForSkill = position;
            
            const skillSelection = document.getElementById('skillSelection');
            const skillTitle = document.getElementById('skillSelectionTitle');
            const skillDropdown = document.getElementById('skillDropdown');
            
            skillTitle.textContent = `${character.name} ã®ã‚¹ã‚­ãƒ«é¸æŠ`;
            skillDropdown.innerHTML = '<option value="">ã‚¹ã‚­ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„</option>';
            
            character.skills.forEach((skill, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${skill.name} (SP:${skill.cost})`;
                option.disabled = skill.cost > character.currentSP;
                skillDropdown.appendChild(option);
            });
            
            skillSelection.style.display = 'block';
            
            // é¸æŠã•ã‚ŒãŸçŠ¶æ…‹ã‚’è¡¨ç¤º
            document.querySelectorAll('.character-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.getElementById(`char_card_${position}`).classList.add('selected');
        }
        
        // ã‚¹ã‚­ãƒ«é¸æŠ
        function selectSkill() {
            const skillDropdown = document.getElementById('skillDropdown');
            const skillIndex = skillDropdown.value;
            
            if (skillIndex !== '' && selectedCharacterForSkill !== null) {
                const playerIndex = positionMap[selectedCharacterForSkill];
                const character = currentParty[playerIndex];
                const skill = character.skills[skillIndex];
                
                turnActions[selectedCharacterForSkill] = {
                    character: character.name,
                    skill: skill,
                    position: selectedCharacterForSkill
                };
                
                // UIæ›´æ–°
                const card = document.getElementById(`char_card_${selectedCharacterForSkill}`);
                card.style.border = '3px solid #4ade80';
                
                document.getElementById('skillSelection').style.display = 'none';
                selectedCharacterForSkill = null;
                
                updateExecuteButton();
            }
        }
        
        // å®Ÿè¡Œãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
        function updateExecuteButton() {
            const frontPositions = [0, 1, 2];
            const actionsSet = frontPositions.every(pos => {
                const playerIndex = positionMap[pos];
                const character = currentParty[playerIndex];
                return character && (turnActions[pos] || !character);
            });
            
            document.getElementById('executeBtn').disabled = !actionsSet;
        }
        
        // ã‚¿ãƒ¼ãƒ³å®Ÿè¡Œ
        function executeTurn() {
            const turnData = {
                turn: currentTurn,
                enemyAction: "æ•µè¡Œå‹•",
                characters: []
            };
            
            // SPå›å¾©ã¨ã‚¿ãƒ¼ãƒ³å‡¦ç†
            currentParty.forEach((character, index) => {
                if (!character) return;
                
                const startSP = character.currentSP;
                
                // ã‚¿ãƒ¼ãƒ³é–‹å§‹æ™‚SPå›å¾©
                character.currentSP += 2 + character.spBonus;
                character.currentSP = Math.min(character.currentSP, 20);
                
                // è¡Œå‹•å‡¦ç†
                const position = positionMap.indexOf(index);
                let action = "å¾…æ©Ÿ";
                let endSP = character.currentSP;
                
                if (position < 3 && turnActions[position]) {
                    const skillData = turnActions[position].skill;
                    action = skillData.name;
                    endSP = character.currentSP - skillData.cost;
                    character.currentSP = endSP;
                }
                
                turnData.characters.push({
                    name: character.name,
                    startSP: character.currentSP + (turnActions[positionMap.indexOf(index)]?.skill?.cost || 0) - 2 - character.spBonus,
                    action: action,
                    endSP: character.currentSP
                });
            });
            
            battleHistory.push(turnData);
            updateResultsTable();
            generatePartyDisplay();
            
            // ãƒªã‚»ãƒƒãƒˆ
            turnActions = {};
            document.querySelectorAll('.character-card').forEach(card => {
                card.style.border = '';
                card.classList.remove('selected');
            });
            
            updateExecuteButton();
        }
        
        // æ¬¡ã®ã‚¿ãƒ¼ãƒ³
        function nextTurn() {
            currentTurn++;
            document.getElementById('turnInfo').textContent = `ã‚¿ãƒ¼ãƒ³ ${currentTurn} - æˆ¦é—˜ä¸­`;
        }
    </script>
</body>
</html>